# $FreeBSD$

PACKAGE=lib${LIB}
LIB=	sqlite3
SHLIB_MAJOR?=	0
LIBADD+=	pthread z m

SRCS=	sqlite3.c
INCS=	sqlite3.h sqlite3ext.h

SQLITE=	${SRCTOP}/contrib/sqlite3
.PATH:	${SQLITE}

WARNS?=	0
CFLAGS+=	-I${SQLITE} \
		-DUSE_PREAD=1 \
		-DSTDC_HEADERS=1 \
		-DHAVE_SYS_TYPES_H=1 \
		-DHAVE_SYS_STAT_H=1 \
		-DHAVE_STDLIB_H=1 \
		-DHAVE_STRING_H=1 \
		-DHAVE_MALLOC_USABLE_SIZE=1 \
		-DHAVE_MEMORY_H=1 \
		-DHAVE_STRINGS_H=1 \
		-DHAVE_INTTYPES_H=1 \
		-DHAVE_ISNAN=1 \
		-DHAVE_STDINT_H=1 \
		-DHAVE_UNISTD_H=1 \
		-DHAVE_DLFCN_H=1 \
		-DHAVE_USLEEP=1 \
		-DHAVE_LOCALTIME_R=1 \
		-DHAVE_GMTIME_R=1 \
		-DHAVE_DECL_STRERROR_R=1 \
		-DHAVE_STRCHRNUL=1 \
		-DHAVE_STRERROR_R=1 \
		-DHAVE_POSIX_FALLOCATE=1 \
		-D_REENTRANT=1 \
		-DSQLITE_THREADSAFE=1

.if ${MACHINE_ARCH} == "powerpc64le"
CFLAGS+=	-DSQLITE_BYTEORDER=1234
.endif

CFLAGS+= \
		-DSQLITE_ENABLE_FTS3 -DSQLITE_ENABLE_FTS4 -DSQLITE_ENABLE_FTS5 \
		-DSQLITE_ENABLE_FTS3_TOKENIZER -DSQLITE_ENABLE_FTS3_PARENTHESIS \
		-DSQLITE_ENABLE_JSON1 -DSQLITE_ENABLE_RTREE -DSQLITE_ENABLE_GEOPOLY -DSQLITE_USE_URI \
		-DSQLITE_SECURE_DELETE -DSQLITE_ENABLE_UNLOCK_NOTIFY -DSQLITE_ENABLE_COLUMN_METADATA \
		-DSQLITE_ENABLE_DBSTAT_VTAB -DSQLITE_ENABLE_STAT4 -DSQLITE_ENABLE_MATH_FUNCTIONS \
		-DSQLITE_ENABLE_SNAPSHOT -DSQLITE_HAVE_ZLIB

sqlite3.pc: sqlite3.pc.in
	sed -e 's,@prefix@,/usr,g ; \
		s,@exec_prefix@,$${prefix},g ; \
		s,@libdir@,$${prefix}/lib,g ; \
		s,@includedir@,$${prefix}/include,g ; \
		s,@LIBS@,-lpthread -lz -lm,g ; \
		s,@PACKAGE_VERSION@,3.35.5,g ;' \
		${.ALLSRC} > ${.TARGET}

PCFILES=    sqlite3.pc

.include <bsd.lib.mk>
